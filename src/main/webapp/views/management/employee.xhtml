<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:framework="http://java.sun.com/jsf/composite/components"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title"><h:outputText value="#{msg['menu']['employee']}"/></ui:define>
    <ui:define name="viewname">
        <i class="fa fa-users"></i>
        <p:outputPanel id="viewname" layout="inline">
            <h:outputText value="#{msg['menu']['employee']}"/>
        </p:outputPanel>
    </ui:define>

    <ui:define name="content">
        <h:form id="listForm">
            <framework:dataTable id="employeeTable" widgetVar="employeeTable"
                                 value="#{viewScope.employees}" formDialogId="employeeDialog"
                                 singleSelection="#{viewScope.singleEmployee}" resizableColumns="true"
                                 multipleSelection="#{viewScope.multipleEmployees}">

                <f:facet name="toolbarBtn">
                    <p:commandButton id="import" value="#{msg['framework']['import']}" oncomplete="PF('uploadDialog').show()" actionListener="#{controller.onEntry}"
                                     process="@this" update="@widgetVar(uploadDialog)" icon="pi pi-upload"/>
                    <p:splitButton id="export" value="#{msg['framework']['export']}" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" update="@this" icon="pi pi-download">
                        <p:fileDownload value="#{controller.download(viewScope.employees)}"/>
                        <p:menuitem value="#{msg['framework']['exportTemplate']}" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" update="@this" icon="pi pi-times">
                            <p:fileDownload value="#{controller.download(null)}"/>
                        </p:menuitem>
                    </p:splitButton>
                </f:facet>

                <p:column headerText="#{msg['employee']['no']}">
                    <h:outputText value="#{element.no}"/>
                </p:column>
                <p:column headerText="#{msg['employee']['nameCn']}">
                    <h:outputText value="#{element.nameCn}"/>
                </p:column>
                <p:column headerText="#{msg['employee']['nameEn']}">
                    <h:outputText value="#{element.nameEn}"/>
                </p:column>
                <p:column headerText="#{msg['employee']['position']}">
                    <h:outputText value="#{element.position}"/>
                </p:column>
                <p:column headerText="#{msg['employee']['entryDate']}">
                    <h:outputText value="#{element.entryDate}"/>
                </p:column>

                <p:column headerText="#{msg['employee']['email']}">
                    <h:outputText value="#{element.email}"/>
                </p:column>
                <p:column headerText="#{msg['employee']['status']}">
                    <h:outputText value="#{element.status}"/>
                </p:column>

            </framework:dataTable>
        </h:form>
    </ui:define>
    <ui:define name="dialog">
        <h:form id="dialogForm">

            <framework:dialog id="employeeDialog" value="#{viewScope.employee}" saveUpdate="@widgetVar(employeeTable)">
                <framework:label for="no" value="#{msg['employee']['no']}">
                    <p:inputText id="no" required="true" value="#{viewScope.employee.no}"/>
                </framework:label>
                <framework:label for="nameCn" value="#{msg['employee']['nameCn']}">
                    <p:inputText id="nameCn" required="true" value="#{viewScope.employee.nameCn}"/>
                </framework:label>
                <framework:label for="nameEn" value="#{msg['employee']['nameEn']}">
                    <p:inputText id="nameEn" required="true" value="#{viewScope.employee.nameCn}"/>
                </framework:label>
                <framework:label for="position" value="#{msg['employee']['position']}">
                    <p:inputText id="position" required="true" value="#{viewScope.employee.position}"/>
                </framework:label>

                <framework:label for="entryDate" value="#{msg['employee']['entryDate']}">
                    <p:datePicker id="entryDate" required="true" value="#{viewScope.employee.entryDate}"
                                  converter="#{localDateTimeConverter}" readonlyInput="true" pattern="yyyy年MM月dd日"/>
                </framework:label>

                <framework:label for="email" value="#{msg['employee']['email']}">
                    <p:inputText id="email" value="#{viewScope.employee.email}"/>
                </framework:label>

                <framework:label for="status" value="#{msg['employee']['status']}">
                    <p:selectOneRadio id="status" value="#{viewScope.employee.status}">
                        <f:selectItems value="#{viewScope.statuses}" var="status" itemLabel="#{status.name}" itemValue="#{status}"/>
                    </p:selectOneRadio>
                </framework:label>
            </framework:dialog>
        </h:form>

        <h:form id="uploadForm" enctype="multipart/form-data">
            <framework:dialog id="uploadDialog" widgetVar="uploadDialog" header="#{msg['framework']['import']}"
                              saveUpdate="@widgetVar(employeeTable)" saveDisabled="false" saveMethod="#{controller.saveUploadList}">
                <p:fileUpload widgetVar="uploadDialog" fileUploadListener="#{controller.upload}" mode="advanced" dragDropSupport="false" invalidSizeMessage="内容过大"
                              sizeLimit="500000" fileLimit="1" update="previewPlane" allowTypes="/(\.|\/)(xls|xlsx)$/" process="@this">

                </p:fileUpload>
                <p:outputPanel id="previewPlane" deferred="true">
                    <p:dataTable id="previewTable" widgetVar="previewTable" rendered="#{viewScope.uploadList != null}" rowKey="#{element}"
                                 value="#{viewScope.uploadList}" var="element" emptyMessage="#{msg['framework']['noRecords']}">
                        <p:columns var=""></p:columns>
                        <p:column headerText="#{msg['employee']['no']}">
                            <h:outputText value="#{element.no}"/>
                        </p:column>
                        <p:column headerText="#{msg['employee']['nameCn']}">
                            <h:outputText value="#{element.nameCn}"/>
                        </p:column>
                        <p:column headerText="#{msg['employee']['nameEn']}">
                            <h:outputText value="#{element.nameEn}"/>
                        </p:column>
                        <p:column headerText="#{msg['employee']['position']}">
                            <h:outputText value="#{element.position}"/>
                        </p:column>
                        <p:column headerText="#{msg['employee']['entryDate']}">
                            <h:outputText value="#{element.entryDate}"/>
                        </p:column>

                        <p:column headerText="#{msg['employee']['email']}">
                            <h:outputText value="#{element.email}"/>
                        </p:column>
                        <p:column headerText="#{msg['employee']['status']}">
                            <h:outputText value="#{element.status}"/>
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>
            </framework:dialog>
        </h:form>
    </ui:define>
</ui:composition>